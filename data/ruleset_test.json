{
  "section_order": [
    "gating_questions",
    "healthcare_contacts",
    "other_symptoms",
    "functional_impact"
  ],
  
  
  "conditions": {
    "vl_interval_visual_loss_is_true": {
      "all": [
        {
          "is_true": "vl_interval_visual_loss"
        }
      ]
    },
    "vl_improved": {
      "all": [
        {
          "is_true": "vl_improved"
        }
      ]
    },
    "partial_visual_loss": {
      "all": [
        {
          "eq": [
            "vl_degree",
            "partial"
          ]
        }
      ]
    },
    "vl_worsening": {
      "all": [
        {
          "is_true": "vl_worsening"
        }
      ]
    },
    "partial_monocular_loss": {
      "all": [
        {
          "eq": [
            "vl_single_eye",
            "single"
          ]
        },
        {
          "ne": [
            "vl_degree",
            "total"
          ]
        }
      ]
    },
    "complete_monocular_loss": {
      "all": [
        {
          "eq": [
            "vl_single_eye",
            "single"
          ]
        },
        {
          "eq": [
            "vl_degree",
            "total"
          ]
        }
      ]
    },
    "vl_intermittent": {
      "all": [
        {
          "eq": [
            "vl_temporal_pattern",
            "intermittent"
          ]
        }
      ]
    },
    "vl_single_eye_is_single": {
      "all": [
        {
          "eq": [
            "vl_single_eye",
            "single"
          ]
        }
      ]
    },
    "vl_single_eye_is_both": {
      "all": [
        {
          "eq": [
            "vl_single_eye",
            "both"
          ]
        }
      ]
    },
    "h_intermittent": {
      "all": [
        {
          "eq": [
            "h_temporal_pattern",
            "intermittent"
          ]
        }
      ]
    },
    "agnosia": {
      "all": [
        {
          "is_true": "vl_agnosia"
        }
      ]
    },

    "hc_contact_occurred": {
      "all": [
        {
          "is_true": "hc_contact_occurred"
        }
      ]
    },
    "alexia": {
      "all": [
        {
          "is_true": "difficulty_reading"
        }
      ]
    },
    "prosopagnosia": {
      "all": [
        {
          "is_true": "difficulty_recognising_people"
        }
      ]
    },
    "akinetopsia": {
      "all": [
        {
          "is_false": "can_see_moving_water"
        }
      ]
    },
  },
  

  
  "trigger_conditions": {
    "vl_present_trigger": {
      "condition": {
        "is_true": "vl_present"
      },
      "activates": "vl_detailed"
    },
    "h_present_trigger": {
      "condition": {
        "is_true": "h_present"
      },
      "activates": "h_detailed"
    },
    "ac_present_trigger": {
      "condition": {
        "is_true": "ac_present"
      },
      "activates": "ac_detailed"
    },
    "subacute_monocular_loss_hours_days": {
      "condition": {
        "all": [
          {
            "eq": [
              "vl_single_eye",
              "single"
            ]
          },
          {
            "eq": [
              "vl_onset_speed",
              "subacute"
            ]
          }
        ]
      },
      "activates": "block_1"
    },
    "agnosia": {
      "condition": {
        "all": [
          {
            "is_true": "vl_agnosia"
          }
        ]
      },
      "activates": "block_6"
    },
  },
  

  
  "sections": {
  "gating_questions": [
    {
      "id": "vl_1",
      "type": "probe",
      "question": "Have you experienced visual loss in this episode?",
      "field": "vl_present",
      "field_type": "boolean"
    },
    {
      "id": "h_1",
      "type": "probe",
      "question": "Are you experiencing a headache?",
      "field": "h_present",
      "field_type": "boolean"
    },
    {
      "id": "ac_1",
      "type": "probe",
      "question": "Any change in the appearance of your eyes or around your eyes?  For example redness, rashes, changes in your pupils, discharge, eyelid problems?",
      "field": "ac_present",
      "field_type": "boolean"
    }
  ],

    "healthcare_contacts": [
      {
        "id": "hc_1",
        "type": "probe",
        "question": "For this episode, did you have any contact with a healthcare professional?",
        "field": "hc_contact_occurred",
        "field_type": "boolean"
      },
      {
        "id": "hc_2",
        "type": "conditional",
        "question": "Did you have any investigations or receive any treatments? Please could you list them.",
        "condition": "hc_contact_occurred",
        "field": "hc_investigations_and_treatments",
        "field_type": "text",
        "comment": "Response Parser will separate investigations from treatments"
      }
    ],
    "other_symptoms": [
      {
        "id": "os_1",
        "type": "probe",
        "question": "Any other associated symptoms that you haven't mentioned?",
        "field": "other_symptoms",
        "field_type": "text"
      }
    ],
    "functional_impact": [
      {
        "id": "fi_1",
        "type": "probe",
        "question": "How has this episode affected you?",
        "field": "functional_impact",
        "field_type": "text",
        "comment": "Impact on daily activities, work, driving, etc."
      }
    ]
  },
  

  
  "follow_up_blocks": {
    
    "vl_detailed": {
      "name": "Visual Loss",
      "questions": [
        {
          "id": "vl_2",
          "type": "probe",
          "question": "Can I ask if the vision is affected in one eye or both?",
          "field": "vl_single_eye",
          "field_type": "categorical",
          "valid_values": [
            "single",
            "both"
          ],
          "comment": "Initial laterality question - if single, triggers vl_3. If both, triggers vl_4."
        },
      {
        "id": "vl_3",
        "type": "conditional",
        "question": "Which eye is affected?",
        "condition": "vl_single_eye_is_single",
        "field": "vl_laterality",
        "field_type": "categorical",
        "valid_values": [
          "left",
          "right"
        ],
        "comment": "Follow-up to specify which eye - only asked if vl_single_eye is 'single'"
      },
      {
        "id": "vl_4",
        "type": "conditional",
        "question": "Were both eyes affected at the same time, or did one start first?",
        "condition": "vl_single_eye_is_both",
        "field": "vl_onset_simultaneity",
        "field_type": "categorical",
        "valid_values": [
          "simultaneous",
          "sequential"
        ],
        "comment": "If sequential = bilateral_monocular pattern; if simultaneous = true binocular"
      },
      {
        "id": "vl_5",
        "type": "probe",
        "question": "And can you describe which part of the field of vision is affected?",
        "field": "vl_field",
        "field_type": "text"
      },
      {
        "id": "vl_6",
        "type": "probe",
        "question": "At its worst, in the affected area, how much could you see?",
        "field": "vl_degree",
        "field_type": "categorical",
        "valid_values": [
          "partial",
          "total"
        ],
        "comment": "Categorization for trigger logic"
      },
      {
        "id": "vl_7",
        "type": "probe",
        "question": "Could you describe what you could or couldn't see? For example, could you read fine print, count fingers, see hand movements?",
        "field": "vl_acuity_description",
        "field_type": "text",
        "comment": "Detailed acuity description - complements vl_degree"
      },
      {
        "id": "vl_8",
        "type": "probe",
        "question": "When did this first start?",
        "field": "vl_first_onset",
        "field_type": "text",
        "comment": "Date or timeframe - e.g. '3 months ago', 'last Tuesday'"
      },
      {
        "id": "vl_9",
        "type": "probe",
        "question": "How quickly did it develop?",
        "field": "vl_onset_speed",
        "field_type": "categorical",
        "valid_values": [
          "acute",
          "subacute",
          "chronic"
        ],
        "definitions": {
          "acute": "seconds to minutes",
          "subacute": "hours to days",
          "chronic": "weeks or longer"
        }
      },
      {
        "id": "vl_10",
        "type": "probe",
        "question": "Is it constant or does it come and go?",
        "field": "vl_temporal_pattern",
        "field_type": "categorical",
        "valid_values": [
          "permanent",
          "transient",
          "intermittent"
        ],
        "definitions": {
          "permanent": "came on and didn't improve",
          "transient": "came on then resolved completely",
          "intermittent": "comes and goes repeatedly"
        }
      },
      {
        "id": "vl_11",
        "type": "conditional",
        "question": "How long does each flare-up last?",
        "condition": "vl_intermittent",
        "field": "vl_flareup_usual_duration",
        "field_type": "text"
      },
      {
        "id": "vl_12",
        "type": "conditional",
        "question": "How often do you get these flare-ups?",
        "condition": "vl_intermittent",
        "field": "vl_flareup_frequency",
        "field_type": "text"
      },
      {
        "id": "vl_13",
        "type": "conditional",
        "question": "Is there still visual loss between flare-ups?",
        "condition": "vl_intermittent",
        "field": "vl_interval_visual_loss",
        "field_type": "Boolean"
      },
      {
        "id": "vl_14",
        "type": "conditional",
        "question": "How bad is the vision between flare-ups? Do you know what the acuity is like in the interval",
        "condition": "vl_interval_visual_loss_is_true",
        "field": "vl_interval_acuity",
        "field_type": "text"
      },
      {
        "id": "vl_15",
        "type": "conditional",
        "question": "After it started, did it keep getting worse?",
        "condition": "partial_visual_loss",
        "field": "vl_worsening",
        "field_type": "boolean"
      },
      {
        "id": "vl_16",
        "type": "conditional",
        "question": "Was it still worsening after 2 weeks?",
        "condition": "vl_worsening",
        "field": "vl_worsening_after_2_weeks",
        "field_type": "boolean"
      },
      {
        "id": "vl_17",
        "type": "conditional",
        "question": "And at any point did it start to improve?",
        "condition": "partial_visual_loss",
        "field": "vl_improved",
        "field_type": "boolean"
      },
      {
        "id": "vl_18",
        "type": "conditional",
        "question": "Did the vision loss completely resolve at the end of this episode?",
        "condition": "vl_improved",
        "field": "vl_completely_resolved",
        "field_type": "boolean"
      },
      {
        "id": "vl_19",
        "type": "conditional",
        "question": "Do you ever have brief blackouts in vision when you look around?",
        "condition": "partial_monocular_loss",
        "field": "vl_blackouts",
        "field_type": "boolean"
      },
      {
        "id": "vl_20",
        "type": "probe",
        "question": "Is anything specific missing from your vision, or are you having difficulty recognising things, for example, certain things, people, or faces?",
        "field": "vl_agnosia",
        "field_type": "boolean",
        "comment": "Screens for visual agnosia"
      },
      {
        "id": "vl_21",
        "type": "conditional",
        "question": "Can you describe it to me in more detail?",
        "condition": "agnosia",
        "field": "vl_agnosia_description",
        "field_type": "text"
      }
    ]
  },
    
    
    
    "h_detailed": {
      "name": "Headache",
      "questions": [
        {
        "id": "h_2",
        "type": "probe",
        "question": "Could you describe what the headache felt like?",
        "field": "h_character",
        "field_type": "text"
      },
      {
        "id": "h_3",
        "type": "probe",
        "question": "When did this headache start?",
        "field": "h_first_onset",
        "field_type": "text"
      },
      {
        "id": "h_4",
        "type": "probe",
        "question": "Is it episodic, coming and going, or persistent and constant?",
        "field": "h_temporal_pattern",
        "field_type": "categorical",
        "valid_values": [
          "permanent",
          "transient",
          "intermittent"
        ]
      },
      {
        "id": "h_5",
        "type": "conditional",
        "question": "When you do get a flare-up, how long does it tend to last?",
        "condition": "h_intermittent",
        "field": "h_flareup_usual_duration",
        "field_type": "text"
      },
      {
        "id": "h_6",
        "type": "conditional",
        "question": "And how often do these flare-ups happen?",
        "condition": "h_intermittent",
        "field": "h_flareup_frequency",
        "field_type": "text"
      },
      {
        "id": "h_7",
        "type": "conditional",
        "question": "In between flare-ups, how bad is the headache?",
        "condition": "h_intermittent",
        "field": "h_interval_severity",
        "field_type": "integer",
        "valid_range": [
          1,
          11
        ]
      },
      {
        "id": "h_8",
        "type": "conditional",
        "question": "And how about at it's worst?  How would you rate the pain on a scale of 1-10?",
        "condition": "h_intermittent",
        "field": "h_worst_severity",
        "field_type": "integer",
        "valid_range": [
          1,
          11
        ]
      },
      {
        "id": "h_9",
        "type": "probe",
        "question": "Where is the headache located?",
        "field": "h_location",
        "field_type": "text"
      },
      {
        "id": "h_10",
        "type": "probe",
        "question": "Does it worsen with straining, like lifting heavy objects or pushing on the toilet?",
        "field": "h_worse_on_straining",
        "field_type": "boolean"
      },
      {
        "id": "h_11",
        "type": "probe",
        "question": "Is it worse at any time of day, like morning or evening?",
        "field": "h_time_of_day",
        "field_type": "categorical",
        "valid_values": [
          "morning",
          "evening",
          "none"
        ]
      },
      {
        "id": "h_12",
        "type": "probe",
        "question": "Have the headaches completely resolved?",
        "field": "h_completely_resolved",
        "field_type": "boolean"
      }
    ]
  },


    "ac_detailed": {
      "name": "Appearance Changes",
      "questions": [
      {
        "id": "ac_2",
        "type": "probe",
        "question": "Do you have redness or a pink appearance?",
        "field": "ac_redness",
        "field_type": "boolean"
      },
      {
        "id": "ac_3",
        "type": "probe",
        "question": "Do you have any discharge?",
        "field": "ac_discharge",
        "field_type": "boolean"
      },
      {
        "id": "ac_4",
        "type": "probe",
        "question": "Has one or both eyes begun to bulge (proptosis)?",
        "field": "ac_proptosis",
        "field_type": "boolean"
      },
      {
        "id": "ac_5",
        "type": "probe",
        "question": "Is one of your eyelids drooping (ptosis)?",
        "field": "ac_ptosis",
        "field_type": "boolean"
      },
      {
        "id": "ac_6",
        "type": "probe",
        "question": "Have you noticed any changes in your pupils?",
        "field": "ac_pupillary_changes",
        "field_type": "boolean"
      },
      {
        "id": "ac_7",
        "type": "probe",
        "question": "Do you have any rashes around your eyes?",
        "field": "ac_rashes",
        "field_type": "boolean"
      }
    ]
  },
    
    "block_1": {
      "name": "Optic Neuritis Screen",
      "questions": [
        {
          "id": "b1_1",
          "type": "probe",
          "question": "Do your symptoms worsen with exercise or heat exposure?",
          "field": "b1_uhthoff_phenomenon",
          "field_type": "boolean"
        },
        {
          "id": "b1_2",
          "type": "probe",
          "question": "Do moving objects appear closer or further than they are?",
          "field": "b1_pulfrich_phenomenon",
          "field_type": "boolean"
        }
      ]
    },
    
    
    
    "block_6": {
      "name": "Higher Visual Processing Screen",
      "questions": [
        {
          "id": "b6_1",
          "type": "probe",
          "question": "Are you having difficulty reading words?",
          "field": "b6_difficulty_reading",
          "field_type": "boolean",
          "comment": "Screens for alexia"
        },
        {
          "id": "b6_2",
          "type": "conditional",
          "question": "If you spell out a word letter by letter, can you then recognise it?",
          "condition": "alexia",
          "field": "b6_can_read_by_spelling",
          "field_type": "boolean"
        },
        {
          "id": "b6_3",
          "type": "probe",
          "question": "Have you had trouble recognizing people you know, like family members or friends?",
          "field": "b6_difficulty_recognising_people",
          "field_type": "boolean",
          "comment": "Screens for prosopagnosia"
        },
        {
          "id": "b6_4",
          "type": "conditional",
          "question": "If you hear their voice, can you then recognise them?",
          "condition": "prosopagnosia",
          "field": "b6_can_recognise_people_by_voice",
          "field_type": "boolean"
        },
        {
          "id": "b6_5",
          "type": "probe",
          "question": "Are you having trouble finding your way around places you know well, like your home or neighborhood?",
          "field": "b6_trouble_navigating",
          "field_type": "boolean"
        },
        {
          "id": "b6_6",
          "type": "probe",
          "question": "When you look at a busy scene, can you see the whole picture, or do you only see one thing at a time?",
          "field": "b6_can_see_whole_picture",
          "field_type": "boolean",
          "comment": "Screens for simultanagnosia"
        },
        {
          "id": "b6_7",
          "type": "probe",
          "question": "If you watch water being poured, does it look frozen or static?",
          "field": "b6_can_see_moving_water",
          "field_type": "boolean",
          "comment": "Screens for akinetopsia"
        },
        {
          "id": "b6_8",
          "type": "conditional",
          "question": "And if you watch a car going down the street, can you see it moving or does it seem to be far away and then suddenly closer?",
          "condition": "akinetopsia",
          "field": "b6_can_see_car_movement",
          "field_type": "boolean"
        }
      ]
    }
  }
}
